<!doctype html>
<head>
  <meta charset="utf-8">

  <title>Enigma</title>
  <meta name="description" content="Enigma">
  <meta name="viewport" content="width=device-width">
   
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
  
 
<!-- This is the Bootstrap Docs -->

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>

  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<link rel="stylesheet" href="http://github.hubspot.com/odometer/themes/odometer-theme-default.css" />
<script src="http://github.hubspot.com/odometer/odometer.js"></script>
  

  <link rel="stylesheet" href="css/index.css">


  <link rel="stylesheet" type="text/css" href="css/set1.css" />
  <link rel="stylesheet" type="text/css" href="css/normalize.css" />

</head>

<body onload = "getBrainTeaser()">
  
  <nav class="navbar navbar-inverse navbar-static-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand active" href="#">Enigma</a>
    </div>
    <div>
      <ul class="nav navbar-nav navbar-right" style="margin-right: 3%;">
        <li><a href="index.htmnl">Home</a></li>
        <li><a href="#">Create</a></li>
        
        <!-- Drop Down Menu -->

        <li class = "dropdown">

          <a href="#" id = "myAnchor" class="dropdown-toggle" data-toggle="dropdown"> Profile <span class="caret" style="color: white;"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Profile</a></li>
            <li><a href="#">Solved</a></li>
            <li><a href="#">Unsolved</a></li>
            <li><a href="#">Settings</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="javascript:checkAnswer();">Log Out</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


<!-- Start of main body -->

  <div id="container" style="height: 100%;">

    <!-- Inside First Level -->
    <div id = "main">
      <div id = "left" style="height:100%; Width: 80%;  margin-top: 4%">
        <div id="question">
          <p id = "teaser"> </p>

          <hr class = "line">
          <div id="input1">
          <span class="input input--minoru">
          <textarea placeholder="Enter your answer..." style="resize:none;font-weight: normal; font-family: optima; font-size: 20px; color: black; border-radius: 25px;" class="input__field input__field--minoru" type="text" id="input-13"></textarea> 
          <label class="input__label input__label--minoru" for="input-13">
            
          </label>
        </span>
      </div>
          <p id = "answer"> </p>
        </div>
      </div>

  <!-- Left Side of screen -->
  <!--<textarea id="answer">Your answer goes here!</textarea> -->

  
  
  <div id="right" style="height:100%; Width: 20%;  position: absolute; top:0; right: 0">
    <div id = "scoreBox" style="height: 40%; width: 100%;  position: absolute">
      <p class="odometer" id = "score"> 0 </p>
    </div>
    <div id= "trioB">
      <button class = "buttons" id="submit" onclick = "checkAnswer()"> Submit </button>
      <button class = "buttons" id="btnanswer" onclick = "showAnswer()"> Give up? </button>
      <button class = "buttons" id="next" onclick = "nextTeaser()"> Skip </button>
    </div>
  </div>
</div>
  <script type="text/javascript">
    Parse.initialize("CnC61CI3beai2RyvnxBrz6omXBuPocQF79eua2Vz", "XH3STCvM2oQFPS1FLqguD7xRMS8Dk5tVKoZ3CwnC");
    var answer = ""
    var name;
    var finalScore = 0;
    var wrong = 0
    var scoredec = 0
    var keyterms = ["hello"]
    var num = 1;
    var num2 = 0;
    var piece;
    var currentUser = Parse.User.current();
    //document.getElementById("name").innerHTML = "Welcome " + user.get('username');
    currentUser.fetch().then(function (user) {
      //alert(user.get('btval'))
      num = user.get('btval');
      name = user.get('firstName')
      name = capitalize(name)
      
      //alert(num)
      replace();
});
    function replace() {
      num2 = num;
      getBrainTeaser()
      //alert(num2)
    }

    function capitalize(s)
{
    return s[0].toUpperCase() + s.slice(1);
}

    
    
    document.getElementById("myAnchor").text = name
    
    function nextTeaser() {
      num2 = num2 + 1
      //alert(num)
      currentUser.set("btval", num2)
      //alert("Did this work?")
          currentUser.save(null, {
            success: function(user) {
              //alert("Yes it did.")
              document.getElementById("teaser").innerHTML = ""
              document.getElementById("answer").innerHTML = ""
              window.getBrainTeaser();
            },
            error: function(user,error) {
              alert("Error")
            }
          });
      
    }
    function getBrainTeaser() {
       document.getElementById("input1").style.display = "block";

      var BrainTeaser = Parse.Object.extend("BrainTeasers")
      var query = new Parse.Query(BrainTeaser)
      query.equalTo("Number", num2);
      query.find({
        success: function(results) {
          var object = results[0]
          var teaser = object.get('Question')
          answer = object.get('Answer')
          score = object.get('Score')
          finalscore = score;
          scoredec = (score / 10) * 2
          keyterms = object.get("keyTerms")
          document.getElementById("teaser").innerHTML = teaser
          document.getElementById("score").innerHTML = score
        },
        error: function(error) {
          alert("Error: " + error.code + " " + error.message);
        }
      });
    }
    function showAnswer() {
      document.getElementById("input1").style.display = "none";

      setOutput("<br><b>ANSWER: </b>" + answer, "#FF6666")
      
    }

    function checkAnswer() {
    var correct = false
      var val = document.getElementById('input-13').value;
      val = val.toLowerCase();
      var punctuationless = val.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");
      var arr = punctuationless.match(/\S+/g);
      if (keyterms[0] == "Complicated") {
        correct = true;
        setOutput("Thanks for submitting! We'll verify your answer shortly.", "#FFFF66")
        document.getElementById("answer").innerHTML = "Thanks for submitting! We'll verify your answer shortly."
        
        document.getElementById("input1").style.display = "none";
      }
      for(i = 0; i < arr.length; i++) {
        for (key = 0; key < keyterms.length; key++) {
          var val1 = keyterms[key].toLowerCase();
          var val2 = arr[i];
          if (val1 == val2) {
            correct = true
            document.getElementById("input1").style.display = "none";
            setOutput("You got the right answer!", "#A3FFA3")
            

            }
          

        }
    }

    if (correct != true) {
            setOutput("Incorrect! Please try again.", "#FF6666")
            if (score == (finalscore * 6) / 10) {
               document.getElementById("score").innerHTML = score
            }
            else {
            score = score - scoredec
            document.getElementById("score").innerHTML = score
          }
            
    }
  }

  function setOutput(text,color) {
    document.getElementById("answer").style.display = "block"
    document.getElementById("answer").innerHTML = text;
    document.getElementById("answer").style.backgroundColor = color;

  }
  
  </script>
</body>

</html>